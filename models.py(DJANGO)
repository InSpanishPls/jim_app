from django.db import models

# Definir la clase Usuario
class Usuario(models.Model):
    TIPO_USUARIO_CHOICES = [
        ('Administrador', 'Administrador'),
        ('Entrenador', 'Entrenador'),
        ('Socio', 'Socio'),
    ]
    
    nombre = models.CharField(max_length=100)
    apellidos = models.CharField(max_length=100)
    email = models.EmailField(unique=True)
    fecha_registro = models.DateTimeField(auto_now_add=True)
    tipo = models.CharField(max_length=20, choices=TIPO_USUARIO_CHOICES)

    def __str__(self):
        return f"{self.nombre} {self.apellidos} ({self.tipo})"
        
# Definir la clase Curso
class Curso(models.Model):
    TIPO_CURSO_CHOICES = [
        ('Spinning', 'Spinning'),
        ('Pilates', 'Pilates'),
    ]
    
    titulo = models.CharField(max_length=200)
    descripcion = models.TextField()
    tipo_curso = models.CharField(max_length=20, choices=TIPO_CURSO_CHOICES)
    entrenador = models.ForeignKey(Usuario, on_delete=models.CASCADE, limit_choices_to={'tipo': 'Entrenador'})
    capacidad_maxima = models.PositiveIntegerField()
    fecha_creacion = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.titulo
        
# Definir la clase Matricula
class Matricula(models.Model):
    curso = models.ForeignKey(Curso, on_delete=models.CASCADE)
    socio = models.ForeignKey(Usuario, on_delete=models.CASCADE, limit_choices_to={'tipo': 'Socio'})
    fecha_matricula = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"{self.socio.nombre} {self.socio.apellidos} - {self.curso.titulo}"
        
# Definir la clase Ejercicio
class Ejercicio(models.Model):
    nombre = models.CharField(max_length=200)
    descripcion = models.TextField()
    grupo_muscular = models.CharField(max_length=100)

    def __str__(self):
        return f"{self.nombre} ({self.grupo_muscular})"
        
# Definir la clase Valoracion
class Valoracion(models.Model):
    curso = models.ForeignKey(Curso, on_delete=models.CASCADE)
    socio = models.ForeignKey(Usuario, on_delete=models.CASCADE, limit_choices_to={'tipo': 'Socio'})
    puntuacion = models.PositiveSmallIntegerField(choices=[(i, i) for i in range(1, 6)])
    comentario = models.TextField(blank=True, null=True)
    fecha_creacion = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"Valoraci√≥n de {self.socio.nombre} para {self.curso.titulo}: {self.puntuacion}/5"
